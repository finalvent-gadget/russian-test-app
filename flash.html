<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‹±å˜èªãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã‚«ãƒ¼ãƒ‰ã‚¢ãƒ—ãƒª</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 20px;
            background-color: #f4f7f9;
            color: #333;
        }
        .container {
            max-width: 700px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
        }
        h1 {
            color: #007bff;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        /* --- å…¥åŠ›ç”»é¢ã‚¹ã‚¿ã‚¤ãƒ« --- */
        #input-screen textarea {
            width: 98%;
            min-height: 200px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-family: monospace;
            font-size: 14px;
        }
        #start-button {
            padding: 10px 20px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        #start-button:hover {
            background-color: #218838;
        }

        /* --- ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã‚«ãƒ¼ãƒ‰ç”»é¢ã‚¹ã‚¿ã‚¤ãƒ« --- */
        #card-display {
            text-align: center;
            margin: 40px 0;
            padding: 30px;
            border: 1px dashed #007bff;
            border-radius: 6px;
        }
        #english-word {
            font-size: 3em;
            margin-bottom: 10px;
            color: #000;
        }
        #japanese-meaning {
            font-size: 1.5em;
            color: #dc3545;
            font-weight: bold;
            margin-top: 15px;
        }
        #action-buttons button {
            padding: 15px 30px;
            font-size: 1.2em;
            margin: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: opacity 0.3s;
        }
        #known-button { background-color: #17a2b8; color: white; }
        #unknown-button { background-color: #dc3545; color: white; }
        #next-button { background-color: #007bff; color: white; }
        #known-button:hover, #unknown-button:hover, #next-button:hover {
            opacity: 0.8;
        }
        #stop-button {
            margin-top: 20px;
            background: #6c757d;
            color: white;
            padding: 8px 15px;
            border-radius: 4px;
        }
        .status {
            font-size: 1.1em;
            margin-bottom: 10px;
            color: #6c757d;
        }
        .completion-message {
            text-align: center;
            padding: 50px 0;
            font-size: 1.5em;
            color: #28a745;
            font-weight: bold;
        }
        .example {
             white-space: pre-wrap;
             font-family: monospace;
             background-color: #eee;
             padding: 10px;
             border-radius: 4px;
        }
    </style>
</head>
<body>

<div class="container">
    <h1 id="app-title">è‹±å˜èªãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã‚«ãƒ¼ãƒ‰ã‚¢ãƒ—ãƒª</h1>

    <div id="input-screen">
        <h2>ğŸ“‹ å˜èªãƒªã‚¹ãƒˆã®å…¥åŠ›</h2>
        <p>ä»¥ä¸‹ã®å½¢å¼ã§ã€å­¦ç¿’ã—ãŸã„è‹±å˜èªãƒªã‚¹ãƒˆã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚</p>
        <p><code>è‹±å˜èª&lt;ã‚¿ãƒ–&gt;æ—¥æœ¬èªã®è¨³èª</code></p>
        <div class="example">ä¾‹:<br>intuition	ç›´æ„Ÿ<br>perspective	ãƒ‘ãƒ¼ã‚¹ã‚¯ãƒ†ã‚£ãƒ–</div>
        <textarea id="word-input" placeholder="ã“ã“ã«TSVå½¢å¼ã®å˜èªãƒªã‚¹ãƒˆã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚"></textarea>
        <button id="start-button">å­¦ç¿’é–‹å§‹</button>
    </div>

    <div id="flashcard-screen" style="display:none;">
        
        <div class="status">
            ãƒ©ã‚¦ãƒ³ãƒ‰: <span id="round-counter">0</span> / é€²æ—: <span id="word-progress">0/0</span>
        </div>

        <div id="card-display">
            <h1 id="english-word"></h1> 
            <p id="japanese-meaning" style="display:none;"></p> 
        </div>

        <div id="action-buttons" style="text-align: center;">
            <button id="known-button">çŸ¥ã£ã¦ã„ã‚‹</button>
            <button id="unknown-button">çŸ¥ã‚‰ãªã„</button>
            <button id="next-button" style="display:none;">æ¬¡ã¸</button>
        </div>

        <hr>
        <button id="stop-button">åœæ­¢ã—ã¦å…¥åŠ›ç”»é¢ã«æˆ»ã‚‹</button>
    </div>

    <div id="completion-screen" style="display:none;">
        <div class="completion-message">
            ğŸ‰ ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼ğŸ‰<br>
            å…¨ã¦ã®å˜èªã‚’ç¿’å¾—ã—ã¾ã—ãŸã€‚
        </div>
        <div style="text-align: center;">
            <button id="reset-button" class="btn btn-success">æ–°ã—ã„å…¥åŠ›ã¸æˆ»ã‚‹</button>
        </div>
    </div>

</div>

<script>
    // =======================================================
    // 1. å¤‰æ•°å®šç¾©ã¨DOMè¦ç´ ã®å–å¾—
    // =======================================================
    let allWords = [];       // å…¨ã¦ã®å˜èªãƒ‡ãƒ¼ã‚¿ã¨å­¦ç¿’çŠ¶æ…‹ã‚’ä¿æŒ
    let currentDeck = [];    // ç¾åœ¨ã®ãƒ©ã‚¦ãƒ³ãƒ‰ã§å‡ºé¡Œã™ã‚‹å˜èªãƒªã‚¹ãƒˆ
    let currentIndex = 0;    // currentDeckå†…ã®ç¾åœ¨å‡ºé¡Œä¸­ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
    let roundCount = 0;      // ç¾åœ¨ã®ãƒ©ã‚¦ãƒ³ãƒ‰æ•°
    let totalWords = 0;      // å…¨å˜èªæ•°

    // ç”»é¢è¦ç´ 
    const inputScreenEl = document.getElementById('input-screen');
    const flashcardScreenEl = document.getElementById('flashcard-screen');
    const completionScreenEl = document.getElementById('completion-screen');
    const wordInputEl = document.getElementById('word-input');
    const startButtonEl = document.getElementById('start-button');
    const englishWordEl = document.getElementById('english-word');
    const japaneseMeaningEl = document.getElementById('japanese-meaning');
    const knownButtonEl = document.getElementById('known-button');
    const unknownButtonEl = document.getElementById('unknown-button');
    const nextButtonEl = document.getElementById('next-button');
    const stopButtonEl = document.getElementById('stop-button');
    const resetButtonEl = document.getElementById('reset-button');
    const roundCounterEl = document.getElementById('round-counter');
    const wordProgressEl = document.getElementById('word-progress');

    // =======================================================
    // 2. ãƒ‡ãƒ¼ã‚¿å‡¦ç†ã¨ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
    // =======================================================

    /**
     * é…åˆ—ã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã™ã‚‹ (Fisher-Yates)
     */
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    /**
     * TSVå½¢å¼ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’å˜èªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®é…åˆ—ã«å¤‰æ›ã™ã‚‹
     */
    function parseWordList(inputText) {
        const lines = inputText
            .trim()
            .split('\n')
            .filter(line => line.trim() !== '');

        if (lines.length === 0) return [];

        const parsedData = lines.map(line => {
            const parts = line.split('\t');
            if (parts.length < 2) {
                console.warn("ä¸æ­£ãªè¡Œå½¢å¼ï¼ˆã‚¿ãƒ–åŒºåˆ‡ã‚Šã§ã¯ãªã„ï¼‰:", line);
                return null; 
            }
            return {
                english: parts[0].trim(), 
                japanese: parts[1].trim(),
                isKnown: false // åˆæœŸçŠ¶æ…‹ã¯ã€ŒçŸ¥ã‚‰ãªã„ã€
            };
        }).filter(item => item !== null);

        return parsedData;
    }
    
    // =======================================================
    // 3. ç”»é¢é·ç§»ã¨å­¦ç¿’åˆ¶å¾¡
    // =======================================================

    /**
     * ç”»é¢ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹
     */
    function switchScreen(screenId) {
        inputScreenEl.style.display = 'none';
        flashcardScreenEl.style.display = 'none';
        completionScreenEl.style.display = 'none';
        document.getElementById(screenId).style.display = 'block';
    }

    /**
     * é€²æ—çŠ¶æ³è¡¨ç¤ºã‚’æ›´æ–°ã™ã‚‹ (ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼è¡¨ç¤ºã®ä¿®æ­£éƒ¨åˆ†)
     */
    function updateProgressDisplay() {
        const unknownWordsInAll = allWords.filter(w => !w.isKnown).length;
        const knownCount = totalWords - unknownWordsInAll;
        
        roundCounterEl.textContent = roundCount;
        
        // **ã€ä¿®æ­£å¾Œã®é€²æ—è¡¨ç¤ºã€‘**
        if (flashcardScreenEl.style.display !== 'none') {
            const currentProgress = currentIndex + 1;
            const roundTotal = currentDeck.length;
            
            // ä¾‹: 5/10 (ç¿’å¾—æ¸ˆã¿: 35/45 èª)
            wordProgressEl.innerHTML = 
                `${currentProgress}/${roundTotal} (ç¿’å¾—æ¸ˆã¿: ${knownCount}/${totalWords} èª)`;
        } else {
            // å­¦ç¿’ç”»é¢ä»¥å¤–ã§ã¯ã€å…¨ä½“ã®ç¿’å¾—çŠ¶æ³ã®ã¿ã‚’è¡¨ç¤º (ä¸»ã«ãƒ‡ãƒãƒƒã‚°ç”¨)
             wordProgressEl.innerHTML = `${knownCount}/${totalWords} èª`;
        }
    }

    /**
     * ç¾åœ¨ã®ã‚«ãƒ¼ãƒ‰ã‚’å‡ºé¡Œã™ã‚‹
     */
    function displayCurrentCard() {
        if (currentIndex >= currentDeck.length) {
            // å…¨ã¦ã®å˜èªãŒå‡ºé¡Œã—çµ‚ã‚ã£ãŸã‚‰ã€æ¬¡ã®ãƒ©ã‚¦ãƒ³ãƒ‰ã®å‡¦ç†ã¸ç§»è¡Œ
            checkRoundCompletion();
            return;
        }

        const currentWord = currentDeck[currentIndex];

        // 1. è‹±å˜èªã‚’ç”»é¢ã«è¡¨ç¤º
        englishWordEl.textContent = currentWord.english;
        japaneseMeaningEl.textContent = currentWord.japanese;
        
        // 2. ç”»é¢ã®çŠ¶æ…‹ã‚’å›ç­”å¯èƒ½ã«ãƒªã‚»ãƒƒãƒˆ
        japaneseMeaningEl.style.display = 'none';
        knownButtonEl.style.display = 'inline-block';
        unknownButtonEl.style.display = 'inline-block';
        nextButtonEl.style.display = 'none';

        // 3. ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’æ›´æ–°
        updateProgressDisplay();
    }

    /**
     * ãƒ©ã‚¦ãƒ³ãƒ‰ã®å®Œäº†ã‚’ãƒã‚§ãƒƒã‚¯ã—ã€æ¬¡ã®ãƒ©ã‚¦ãƒ³ãƒ‰ã«é€²ã‚€ã‹å­¦ç¿’ã‚’çµ‚äº†ã™ã‚‹
     */
    function checkRoundCompletion() {
        // å…¨å˜èªã®ä¸­ã‹ã‚‰ã€isKnown: falseï¼ˆçŸ¥ã‚‰ãªã„ï¼‰ã®å˜èªã‚’æŠ½å‡º
        const unknownWords = allWords.filter(word => word.isKnown === false);
        
        if (unknownWords.length === 0) {
            // å­¦ç¿’çµ‚äº†
            switchScreen('completion-screen');
            return;
        }

        // æ¬¡ã®ãƒ©ã‚¦ãƒ³ãƒ‰ã¸ç§»è¡Œ
        roundCount++;
        currentDeck = unknownWords; // çŸ¥ã‚‰ãªã„å˜èªã ã‘ã‚’æ¬¡ã®ãƒ‡ãƒƒã‚­ã«ã™ã‚‹
        currentIndex = 0;
        shuffleArray(currentDeck);
        
        // æ¬¡ã®ãƒ©ã‚¦ãƒ³ãƒ‰ã®æœ€åˆã®å˜èªã‚’å‡ºé¡Œ
        displayCurrentCard();
    }

    // =======================================================
    // 4. ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©
    // =======================================================

    /**
     * å­¦ç¿’é–‹å§‹ãƒœã‚¿ãƒ³ã®å‡¦ç†
     */
    startButtonEl.addEventListener('click', () => {
        const parsedData = parseWordList(wordInputEl.value);
        
        if (parsedData.length === 0) {
            alert("æœ‰åŠ¹ãªå˜èªãŒå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚å½¢å¼ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
            return;
        }

        allWords = parsedData;
        totalWords = allWords.length;
        roundCount = 1;
        currentIndex = 0;
        
        currentDeck = [...allWords]; // æœ€åˆã®ãƒ©ã‚¦ãƒ³ãƒ‰ã¯å…¨å˜èª
        shuffleArray(currentDeck);

        switchScreen('flashcard-screen');
        displayCurrentCard();
    });

    /**
     * ã€ŒçŸ¥ã£ã¦ã„ã‚‹ã€ãƒœã‚¿ãƒ³ã®å‡¦ç†
     */
    knownButtonEl.addEventListener('click', () => {
        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ã€ŒçŸ¥ã£ã¦ã„ã‚‹ã€ã«è¨­å®š
        currentDeck[currentIndex].isKnown = true;
        
        // å³åº§ã«æ¬¡ã®å˜èªã¸
        currentIndex++;
        displayCurrentCard();
    });

    /**
     * ã€ŒçŸ¥ã‚‰ãªã„ã€ãƒœã‚¿ãƒ³ã®å‡¦ç†
     */
    unknownButtonEl.addEventListener('click', () => {
        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ã€ŒçŸ¥ã‚‰ãªã„ã€ã«è¨­å®š
        currentDeck[currentIndex].isKnown = false; 
        
        // è¨³èªã‚’è¡¨ç¤ºã—ã€ãƒœã‚¿ãƒ³ã‚’ã€Œæ¬¡ã¸ã€ã«åˆ‡ã‚Šæ›¿ãˆã‚‹
        japaneseMeaningEl.style.display = 'block';
        knownButtonEl.style.display = 'none';
        unknownButtonEl.style.display = 'none';
        nextButtonEl.style.display = 'inline-block';
    });

    /**
     * ã€Œæ¬¡ã¸ã€ãƒœã‚¿ãƒ³ã®å‡¦ç†ï¼ˆçŸ¥ã‚‰ãªã„å˜èªã®è¨³èªç¢ºèªå¾Œï¼‰
     */
    nextButtonEl.addEventListener('click', () => {
        // æ¬¡ã®å˜èªã¸
        currentIndex++;
        displayCurrentCard();
    });

    /**
     * åœæ­¢ãƒœã‚¿ãƒ³ã€ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ã®å‡¦ç†ï¼ˆå…¥åŠ›ç”»é¢ã¸æˆ»ã‚‹ï¼‰
     */
    function resetAndStop() {
        // å…¨ã¦ã®å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆ
        allWords = [];
        currentDeck = [];
        currentIndex = 0;
        roundCount = 0;
        totalWords = 0;
        
        // ç”»é¢ã‚’å…¥åŠ›ç”»é¢ã«æˆ»ã™
        switchScreen('input-screen');
        wordInputEl.value = ''; // å…¥åŠ›ã‚¨ãƒªã‚¢ã‚’ã‚¯ãƒªã‚¢
    }

    stopButtonEl.addEventListener('click', resetAndStop);
    resetButtonEl.addEventListener('click', resetAndStop);

    // ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚ã®åˆæœŸç”»é¢è¨­å®š
    switchScreen('input-screen');

</script>
</body>
</html>